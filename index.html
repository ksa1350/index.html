<!-- 
Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø£Ø¯Ù…Ù†:
1. Ø±Ù‚Ù… Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©: admin Ø£Ùˆ 6500
2. ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: 1234

Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø¶Ø¨ÙˆØ·Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
-->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ - Ù…Ø¯Ø±Ø³Ø© Ø¹Ù…Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ† Ø²Ù†ÙƒÙŠ">
<title>Ù†Ø¸Ø§Ù… Ù…Ø¯Ø±Ø³Ø© Ø¹Ù…Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ† Ø²Ù†ÙƒÙŠ</title>
<style>
body { font-family:"Tahoma",sans-serif; background:#e6f2ff; margin:0; padding:0; }
header { background:#1f3f68; color:#fff; padding:20px; font-size:26px; text-align:center; }
.container { margin:30px auto; padding:25px; max-width:750px; background:#fff; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.2);} 
input, select, button { width:95%; padding:12px; margin:8px 0; border-radius:8px; border:1px solid #ccc; font-size:16px; transition:0.3s; }
input:focus, select:focus { border-color:#3498db; box-shadow:0 0 8px rgba(52,152,219,0.5); outline:none; }
button { background:#3498db; color:#fffbfb; cursor:pointer; border:none; font-weight:bold; }
button:hover { background:#2980b9; transform:scale(1.05); box-shadow:0 0 10px rgba(0,0,0,0.3); }
button:active { transform:scale(0.98); }
label { font-size:14px; }
.hidden { display:none; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
table, th, td { border:1px solid #ccc; }
th, td { padding:8px; text-align:center; }
.tip { font-size:12px; color:#555; margin-top:-6px; }

@media (max-width: 768px) {
  .container { margin:10px; padding:15px; }
  input, select, button { width:100%; }
  table { font-size:14px; }
}
</style>
</head>
<body>
<header>Ù…Ø¯Ø±Ø³Ø© Ø¹Ù…Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ† Ø²Ù†ÙƒÙŠ</header>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginPage" class="container">
  <h2 style="text-align:center; color:#1e3a5f;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <input type="text" id="loginId" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©">
  <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <label><input type="checkbox" id="rememberMe"> ØªØ°ÙƒØ±Ù†ÙŠ</label>
  <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- Ø§Ø®ØªÙŠØ§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·) -->
<div id="adminChoice" class="container hidden">
  <h2 style="text-align:center; color:#1e3a5f;">Ø§Ø®ØªØ± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
  <button id="toAdmin">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</button>
  <button id="toTeacher">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³</button>
  <button id="toStudent">Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
  <button style="background:#e74c3c;" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† -->
<div id="adminPage" class="container hidden">
  <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</h2>
  <button onclick="showSection('addTeacher')">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø±Ø³</button>
  <button onclick="showSection('addStudent')">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
  <button onclick="showSection('importExcel')">ğŸ“‚ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ù† Ø¥ÙƒØ³Ù„</button>
  <button onclick="showSection('report')">ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
  <button onclick="showSection('manage')">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
  <button onclick="deleteAllStudents()" style="background:#e74c3c">ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
  <button style="background:#e74c3c;" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

  <!-- Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø±Ø³ -->
  <div id="addTeacher" class="hidden">
    <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø±Ø³</h3>
    <input type="text" id="teacherName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³">
    <input type="text" id="teacherId" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©">
    <input type="password" id="teacherPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <label><input type="checkbox" id="isAdmin"> Ø£Ø¯Ù…Ù†ØŸ</label>
    <button onclick="addTeacher()">Ø­ÙØ¸</button>
  </div>

  <!-- Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ -->
  <div id="addStudent" class="hidden">
    <h3>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</h3>
    <input type="text" id="studentName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
    <input type="text" id="studentId" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©">
    <input type="password" id="studentPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <select id="grade">
      <option>Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·</option>
    </select>
    <select id="class">
      <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
      <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
    </select>
    <button onclick="addStudent()">Ø­ÙØ¸</button>
  </div>

  <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ù† Ø¥ÙƒØ³Ù„ -->
  <div id="importExcel" class="hidden">
    <h3>ğŸ“‚ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ù† Ù…Ù„Ù Ø¥ÙƒØ³Ù„</h3>
    <div class="tip">A = Ø§Ù„ÙØµÙ„ØŒ C = Ø§Ù„Ø§Ø³Ù…ØŒ D = Ø§Ù„Ù‡ÙˆÙŠØ©</div>
    <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©</label>
    <select id="importGrade">
      <option value="">â€” Ø§Ø®ØªØ± â€”</option>
      <option>Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·</option>
    </select>
    <input type="file" id="excelFile" accept=".xls,.xlsx">
    <button onclick="importExcel()">Ø±ÙØ¹ ÙˆØ¥Ø¶Ø§ÙØ©</button>
  </div>

  <!-- Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
  <div id="report" class="hidden">
    <h3>Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
    <input type="text" id="filterStudent" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©">
    <label>Ù…Ù† ØªØ§Ø±ÙŠØ®:</label>
    <input type="date" id="filterFromDate">
    <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®:</label>
    <input type="date" id="filterToDate">
    <select id="filterGrade"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©</option><option>Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·</option></select>
    <select id="filterClass"><option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select>
    <select id="filterSession"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­ØµØ©</option><option>Ø§Ù„Ø£ÙˆÙ„Ù‰</option><option>Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option><option>Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option><option>Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</option><option>Ø§Ù„Ø®Ø§Ù…Ø³Ø©</option><option>Ø§Ù„Ø³Ø§Ø¯Ø³Ø©</option><option>Ø§Ù„Ø³Ø§Ø¨Ø¹Ø©</option></select>
    <button onclick="showReport()">Ø¹Ø±Ø¶</button>
    <button onclick="downloadCSV()">ØªØ­Ù…ÙŠÙ„ CSV</button>
    <div id="reportTable"></div>
    <div id="reportStats" style="font-weight:bold; margin-top:10px;"></div>
  </div>

  <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
  <div id="manage" class="hidden">
    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†</h3>
    <input type="text" id="searchId" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©">
    <button onclick="searchUser()">Ø¨Ø­Ø«</button>
    <div id="searchResult"></div>
  </div>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ -->
<div id="teacherPage" class="container hidden">
  <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³</h2>
  <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©</label>
  <select id="teacherGrade">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©</option>
    <option>Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·</option>
  </select>
  <label>Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„</label>
  <select id="teacherClass">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„</option>
    <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
    <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
  </select>
  <label>Ø§Ø®ØªØ± Ø§Ù„Ø­ØµØ©</label>
  <select id="sessionSelect">
    <option>Ø§Ù„Ø£ÙˆÙ„Ù‰</option><option>Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option><option>Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option>
    <option>Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</option><option>Ø§Ù„Ø®Ø§Ù…Ø³Ø©</option><option>Ø§Ù„Ø³Ø§Ø¯Ø³Ø©</option><option>Ø§Ù„Ø³Ø§Ø¨Ø¹Ø©</option>
  </select>
  <button onclick="loadStudents()">Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
  <div id="studentList">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© ÙˆØ§Ù„ÙØµÙ„ Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨.</div>
  <button style="background:#e74c3c;" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ -->
<div id="studentPage" class="container hidden">
  <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
  <label>Ø§Ø®ØªØ± ÙŠÙˆÙ…</label>
  <input type="date" id="studentDay">
  <button onclick="showStudentDay()">Ø¹Ø±Ø¶</button>
  <hr>
  <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
  <input type="date" id="fromDate">
  <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
  <button onclick="showStudentRange()">Ø¹Ø±Ø¶ Ø§Ù„ÙØªØ±Ø©</button>
  <div id="studentReport"></div>
  <button style="background:#e74c3c;" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
// ================== Ø¨ÙŠØ§Ù†Ø§Øª ==================
let users = JSON.parse(localStorage.getItem("users")) || [];
let students = JSON.parse(localStorage.getItem("students")) || [];
let attendance = JSON.parse(localStorage.getItem("attendance")) || [];

// Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
(function ensureAdmins(){
  if(!users.find(u=>u.id==="admin" && u.isAdmin))
    users.push({id:"admin", name:"Ø§Ù„Ù…Ø¯ÙŠØ±", password:"1234", isAdmin:true});
  if(!users.find(u=>u.id==="6500" && u.isAdmin))
    users.push({id:"6500", name:"Ø§Ù„Ù…Ø¯ÙŠØ±", password:"1234", isAdmin:true});
  localStorage.setItem("users", JSON.stringify(users));
})();

let currentUser = JSON.parse(localStorage.getItem("currentUser"));
window.onload = function(){
  if(currentUser){
    if(currentUser.isAdmin) showPage("adminChoice");
    else if(currentUser.isTeacher) showTeacherPage();
    else if(currentUser.isStudent) showStudentPage();
  }
}

document.getElementById('loginBtn').addEventListener('click', login);
['loginId','loginPassword'].forEach(id=>{
  document.getElementById(id).addEventListener('keyup', e=>{ if(e.key==='Enter') login(); });
});

document.getElementById('toAdmin').addEventListener('click',()=>showPage('adminPage'));
document.getElementById('toTeacher').addEventListener('click',showTeacherPage);
document.getElementById('toStudent').addEventListener('click',showStudentPage);

['teacherGrade','teacherClass'].forEach(id=>{
  document.getElementById(id).addEventListener('change', loadStudents);
});

// ============= ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ =============
function login(){
  const id=document.getElementById("loginId").value.trim();
  const pass=document.getElementById("loginPassword").value.trim();
  const remember=document.getElementById("rememberMe").checked;
  const user=users.find(u=>u.id===id && u.password===pass);
  if(!user){ alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©"); return; }
  currentUser=user;
  if(remember) localStorage.setItem("currentUser", JSON.stringify(user));
  else localStorage.removeItem("currentUser");
  if(user.isAdmin) showPage("adminChoice");
  else if(user.isTeacher) showTeacherPage();
  else if(user.isStudent) showStudentPage();
}

function logout(){ currentUser=null; localStorage.removeItem("currentUser"); showPage("loginPage"); }
function showPage(pageId){
  ["loginPage","adminPage","teacherPage","adminChoice","studentPage"].forEach(id=>document.getElementById(id).classList.add("hidden"));
  document.getElementById(pageId).classList.remove("hidden");
}
function showTeacherPage(){ showPage('teacherPage'); }
function showStudentPage(){ showPage('studentPage'); }

function showSection(sectionId){
  ["addTeacher","addStudent","report","manage","importExcel"].forEach(id=>document.getElementById(id).classList.add("hidden"));
  document.getElementById(sectionId).classList.remove("hidden");
}

// ============= Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø±Ø³ =============
function addTeacher(){
  const name=document.getElementById("teacherName").value.trim();
  const id=document.getElementById("teacherId").value.trim();
  const pass=document.getElementById("teacherPassword").value.trim();
  const isAdmin=document.getElementById("isAdmin").checked;
  if(!name||!id||!pass){alert("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");return;}
  if(users.find(u=>u.id===id)){alert("Ø§Ù„Ù…Ø¹Ù„Ù… Ù…ÙˆØ¬ÙˆØ¯"); return;}
  users.push({id,name,password:pass,isAdmin,isTeacher:true});
  localStorage.setItem("users",JSON.stringify(users));
  alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯Ø±Ø³");
}

// ============= Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ =============
function addStudent(){
  const name=document.getElementById("studentName").value.trim();
  const id=document.getElementById("studentId").value.trim();
  const pass=document.getElementById("studentPassword").value.trim();
  const grade=document.getElementById("grade").value;
  const cls=document.getElementById("class").value;
  if(!name||!id||!pass){alert("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");return;}
  if(students.find(s=>s.id===id)){alert("Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…ÙˆØ¬ÙˆØ¯");return;}
  students.push({id,name,grade,class:cls});
  users.push({id,name,password:pass,isStudent:true});
  localStorage.setItem("students",JSON.stringify(students));
  localStorage.setItem("users",JSON.stringify(users));
  alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨");
}

// ============= Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Ø§ÙƒØ³Ù„ =============
function importExcel(){
  const file=document.getElementById("excelFile").files[0];
  const chosenGrade=document.getElementById("importGrade").value;
  if(!file){alert("Ø§Ø®ØªØ± Ù…Ù„Ù Ø¥ÙƒØ³Ù„"); return;}
  const reader=new FileReader();
  reader.onload=function(e){
    const data=new Uint8Array(e.target.result);
    const workbook=XLSX.read(data,{type:'array'});
    const sheet=workbook.Sheets[workbook.SheetNames[0]];
    const rows=XLSX.utils.sheet_to_json(sheet,{header:1});
    let added=0;
    for(let i=1;i<rows.length;i++){
      const r=rows[i];
      const cls=r[0];
      const name=r[2];
      const id=r[3];
      if(!name||!id) continue;
      let grade=chosenGrade||"";
      if(!students.find(s=>s.id==id)){
        students.push({id,name,grade,class:cls});
        users.push({id,name,password:"1234",isStudent:true});
        added++;
      }
    }
    localStorage.setItem("students",JSON.stringify(students));
    localStorage.setItem("users",JSON.stringify(users));
    alert("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ "+added+" Ø·Ø§Ù„Ø¨");
  };
  reader.readAsArrayBuffer(file);
}

// ============= ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„Ù„Ù…Ø¯Ø±Ø³ =============
function loadStudents(){
  const grade=document.getElementById("teacherGrade").value;
  const cls=document.getElementById("teacherClass").value;
  let list=document.getElementById("studentList");
  list.innerHTML="";
  let filtered=students.filter(s=>(!grade||s.grade===grade)&&(!cls||s.class===cls));
  if(filtered.length===0){list.innerHTML="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨."; return;}
  filtered.forEach(s=>{
    let div=document.createElement("div");
    div.innerHTML=`${s.name} (${s.id}) - ${s.grade} ÙØµÙ„ ${s.class} 
    <button onclick="markAttendance('${s.id}','Ø­Ø§Ø¶Ø±')">âœ…</button> 
    <button onclick="markAttendance('${s.id}','Ù…ØªØ£Ø®Ø±')">â°</button> 
    <button onclick="markAttendance('${s.id}','ØºØ§Ø¦Ø¨')">âŒ</button>`;
    list.appendChild(div);
  });
}

// ============= ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± =============
function markAttendance(studentId,status){
  const session=document.getElementById("sessionSelect").value;
  const now=new Date().toISOString().split('T')[0];
  attendance.push({studentId,status,session,teacher:currentUser.name,date:now});
  localStorage.setItem("attendance",JSON.stringify(attendance));
  alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
}

// ============= ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ =============
function showStudentDay(){
  const day=document.getElementById("studentDay").value;
  const data=attendance.filter(a=>a.studentId===currentUser.id && a.date===day);
  displayStudentReport(data);
}
function showStudentRange(){
  const from=document.getElementById("fromDate").value;
  const to=document.getElementById("toDate").value;
  const data=attendance.filter(a=>a.studentId===currentUser.id && (!from||a.date>=from)&&(!to||a.date<=to));
  displayStudentReport(data);
}
function displayStudentReport(data){
  let div=document.getElementById("studentReport");
  if(data.length===0){div.innerHTML="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª"; return;}
  let table="<table><tr><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ø­ØµØ©</th><th>Ø§Ù„Ù…Ø¯Ø±Ø³</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>";
  data.forEach(a=>{ table+=`<tr><td>${a.status}</td><td>${a.session}</td><td>${a.teacher}</td><td>${a.date}</td></tr>`; });
  table+="</table>";
  div.innerHTML=table;
}

// ============= Ø§Ù„ØªÙ‚Ø±ÙŠØ± =============
function showReport(){
  const grade = document.getElementById("filterGrade").value;
  const cls = document.getElementById("filterClass").value;
  const session = document.getElementById("filterSession").value;
  const studentSearch = document.getElementById("filterStudent").value.trim().toLowerCase();
  const fromDate = document.getElementById("filterFromDate").value;
  const toDate = document.getElementById("filterToDate").value;
  
  let data = attendance;
  
  // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
  if(fromDate || toDate) {
    data = data.filter(a => 
      (!fromDate || a.date >= fromDate) && 
      (!toDate || a.date <= toDate)
    );
  }

  // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ÙˆØ§Ù„ÙØµÙ„ ÙˆØ§Ù„Ø·Ø§Ù„Ø¨
  if(grade || cls || studentSearch) {
    const filtered = students.filter(s => 
      (!grade || s.grade === grade) && 
      (!cls || s.class === cls) &&
      (!studentSearch || 
        s.name.toLowerCase().includes(studentSearch) || 
        s.id.toLowerCase().includes(studentSearch))
    ).map(s => s.id);
    data = data.filter(a => filtered.includes(a.studentId));
  }
  
  if(session) data = data.filter(a => a.session === session);

  let table = "<table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡ÙˆÙŠØ©</th><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>Ø§Ù„ÙØµÙ„</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ø­ØµØ©</th><th>Ø§Ù„Ù…Ø¯Ø±Ø³</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>";
  data.forEach(a => {
    const student = students.find(s => s.id === a.studentId);
    if(student) {
      table += `<tr>
        <td>${student.name}</td>
        <td>${student.id}</td>
        <td>${student.grade}</td>
        <td>${student.class}</td>
        <td>${a.status}</td>
        <td>${a.session}</td>
        <td>${a.teacher}</td>
        <td>${a.date}</td>
      </tr>`;
    }
  });
  table += "</table>";
  
  document.getElementById("reportTable").innerHTML = data.length ? table : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª";
  
  // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  const stats = {Ø­Ø§Ø¶Ø±: 0, Ù…ØªØ£Ø®Ø±: 0, ØºØ§Ø¦Ø¨: 0};
  data.forEach(a => stats[a.status]++);
  document.getElementById("reportStats").innerHTML = 
    `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: Ø­Ø¶ÙˆØ± (${stats.Ø­Ø§Ø¶Ø±})ØŒ ØªØ£Ø®Ø± (${stats.Ù…ØªØ£Ø®Ø±})ØŒ ØºÙŠØ§Ø¨ (${stats.ØºØ§Ø¦Ø¨})`;
}

function downloadCSV() {
  const grade = document.getElementById("filterGrade").value;
  const cls = document.getElementById("filterClass").value;
  const session = document.getElementById("filterSession").value;
  const fromDate = document.getElementById("filterFromDate").value;
  const toDate = document.getElementById("filterToDate").value;
  
  let data = attendance;
  if(fromDate || toDate) {
    data = data.filter(a => 
      (!fromDate || a.date >= fromDate) && 
      (!toDate || a.date <= toDate)
    );
  }
  if(grade || cls) {
    const filtered = students.filter(s => 
      (!grade || s.grade === grade) && 
      (!cls || s.class === cls)
    ).map(s => s.id);
    data = data.filter(a => filtered.includes(a.studentId));
  }
  if(session) data = data.filter(a => a.session === session);

  let csv = "Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ù‡ÙˆÙŠØ©,Ø§Ù„Ù…Ø±Ø­Ù„Ø©,Ø§Ù„ÙØµÙ„,Ø§Ù„Ø­Ø§Ù„Ø©,Ø§Ù„Ø­ØµØ©,Ø§Ù„Ù…Ø¯Ø±Ø³,Ø§Ù„ØªØ§Ø±ÙŠØ®\n";
  data.forEach(a => {
    const student = students.find(s => s.id === a.studentId);
    if(student) {
      csv += `${student.name},${student.id},${student.grade},${student.class},${a.status},${a.session},${a.teacher},${a.date}\n`;
    }
  });

  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "ØªÙ‚Ø±ÙŠØ±.csv";
  link.click();
}

function searchUser() {
  const id = document.getElementById("searchId").value.trim();
  const result = document.getElementById("searchResult");
  
  const user = users.find(u => u.id === id);
  if(!user) {
    result.innerHTML = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…";
    return;
  }

  const student = students.find(s => s.id === id);
  let html = `<div>
    Ø§Ù„Ø§Ø³Ù…: ${user.name}<br>
    Ø§Ù„Ù‡ÙˆÙŠØ©: ${user.id}<br>
    Ø§Ù„Ù†ÙˆØ¹: ${user.isAdmin ? 'Ø£Ø¯Ù…Ù†' : user.isTeacher ? 'Ù…Ø¯Ø±Ø³' : 'Ø·Ø§Ù„Ø¨'}<br>`;
  
  if(student) {
    html += `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${student.grade}<br>
    Ø§Ù„ÙØµÙ„: ${student.class}<br>`;
  }
  
  html += `<input type="password" id="newPass_${id}" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
    <button onclick="changePassword('${id}')">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
    <button onclick="deleteUser('${id}')" style="background:#e74c3c">Ø­Ø°Ù</button>
    </div>`;
    
  result.innerHTML = html;
}

function changePassword(id) {
  const newPass = document.getElementById(`newPass_${id}`).value.trim();
  if(!newPass) {
    alert("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©");
    return;
  }
  const user = users.find(u => u.id === id);
  if(user) {
    user.password = newPass;
    localStorage.setItem("users", JSON.stringify(users));
    alert("ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
  }
}

function deleteUser(id) {
  if(!confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) return;
  
  users = users.filter(u => u.id !== id);
  students = students.filter(s => s.id !== id);
  attendance = attendance.filter(a => a.studentId !== id);
  
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("students", JSON.stringify(students));
  localStorage.setItem("attendance", JSON.stringify(attendance));
  
  searchUser();
}

function deleteAllStudents() {
  if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ØŸ\nÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©!")) return;
  if(!confirm("ØªØ£ÙƒÙŠØ¯ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ¨ÙŠØ§Ù†Ø§ØªÙ‡Ù… ÙˆØ³Ø¬Ù„Ø§Øª Ø­Ø¶ÙˆØ±Ù‡Ù…")) return;
  
  // Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ¨ÙŠØ§Ù†Ø§ØªÙ‡Ù…
  const studentIds = students.map(s => s.id);
  users = users.filter(u => !u.isStudent);
  students = [];
  attendance = attendance.filter(a => !studentIds.includes(a.studentId));
  
  // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("students", JSON.stringify(students));
  localStorage.setItem("attendance", JSON.stringify(attendance));
  
  alert("ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ¨ÙŠØ§Ù†Ø§ØªÙ‡Ù…");
}
</script>
</body>
</html>